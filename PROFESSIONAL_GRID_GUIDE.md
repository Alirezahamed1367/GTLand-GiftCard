# راهنمای استفاده از گزارش حرفه‌ای (Professional Grid)
=========================================================

## 📍 مسیر دسترسی:

### از منوی اصلی:
```
برنامه GT-Land → تب "🔄 مدیریت BI" → دکمه "📊 نمایش گزارش Excel-like"
```

### مسیر کامل:
1. اجرای برنامه: `python GT-Land.bat` یا `python app/main.py`
2. در پنجره اصلی به تب **"🔄 مدیریت BI"** بروید
3. در بخش **"📊 گزارش حرفه‌ای"** روی دکمه **"📊 نمایش گزارش Excel-like"** کلیک کنید

### تست مستقیم:
```bash
python test_professional_grid.py
```

---

## ⚙️ شخصی‌سازی ستون‌ها:

### 1. باز کردن تنظیمات:
در پنجره گزارش حرفه‌ای، روی دکمه **"⚙️ شخصی‌سازی ستون‌ها"** کلیک کنید

### 2. انتخاب ستون‌های نمایشی:
- ✅ **انتخاب/حذف ستون**: چک‌باکس کنار هر ستون
- ⬆️⬇️ **تغییر ترتیب**: دکمه‌های بالا/پایین
- ✅ **انتخاب همه**: انتخاب تمام ستون‌ها
- ❌ **حذف همه**: حذف انتخاب همه

**ستون‌های موجود:**
- Label (کد آکانت)
- Email
- تأمین‌کننده
- خرید (Gold)
- نرخ خرید
- هزینه خرید
- جمع فروش
- درآمد کل
- سود/زیان
- درصد سود
- موجودی Gold
- موجودی Silver

### 3. ستون‌های Platform:
- ☑️ **نمایش ستون‌های فروش به تفکیک Platform**
- پلتفرم‌ها به صورت خودکار از داده‌های فروش استخراج می‌شوند
- برای هر Platform دو ستون نمایش داده می‌شود:
  - مقدار فروش
  - درآمد فروش

---

## 🧮 ستون‌های محاسباتی (فرمول):

### افزودن فرمول جدید:

1. **کلیک روی "➕ افزودن فرمول"**

2. **وارد کردن اطلاعات:**
   - **نام ستون**: مثال: "سود به ازای هر Gold"
   - **فرمول محاسباتی**: مثال: `{total_profit} / {gold_purchased}`
   - **فرمت نمایش**:
     - عدد (1234.56)
     - مبلغ (1,234 تومان)
     - درصد (12.5%)

3. **کلیک روی "💾 ذخیره"**

### متغیرهای قابل استفاده در فرمول:

```
• {label}            - کد آکانت
• {gold_purchased}   - مقدار خرید Gold
• {purchase_rate}    - نرخ خرید
• {purchase_cost}    - هزینه خرید
• {total_sold}       - جمع فروش
• {total_revenue}    - درآمد کل
• {total_profit}     - سود کل
• {profit_pct}       - درصد سود
• {remaining_gold}   - موجودی Gold
• {remaining_silver} - موجودی Silver
```

### عملگرهای ریاضی:
```
+   جمع
-   تفریق
*   ضرب
/   تقسیم
()  پرانتز
```

### مثال‌های فرمول:

#### 1. سود به ازای هر Gold:
```
{total_profit} / {gold_purchased}
```
**خروجی**: 2500.50

---

#### 2. مارجین سود (درصد):
```
({total_revenue} - {purchase_cost}) / {total_revenue} * 100
```
**فرمت**: درصد  
**خروجی**: 15.5%

---

#### 3. قیمت فروش متوسط:
```
{total_revenue} / {total_sold}
```
**خروجی**: 5250.00

---

#### 4. سود خالص (با کسر 10% کمیسیون):
```
{total_profit} * 0.9
```
**فرمت**: مبلغ  
**خروجی**: 45,000 تومان

---

#### 5. نسبت فروش به خرید:
```
{total_sold} / {gold_purchased} * 100
```
**فرمت**: درصد  
**خروجی**: 85.5%

---

#### 6. درآمد خالص (با کسر هزینه):
```
{total_revenue} - {purchase_cost} - ({total_revenue} * 0.05)
```
**توضیح**: درآمد - هزینه خرید - 5% کمیسیون

---

### ویرایش/حذف فرمول:

- **✏️ ویرایش**: انتخاب فرمول → کلیک "✏️ ویرایش"
- **🗑️ حذف**: انتخاب فرمول → کلیک "🗑️ حذف"

---

## 💾 ذخیره تنظیمات:

1. بعد از انجام تغییرات، روی **"💾 ذخیره تنظیمات"** کلیک کنید
2. تنظیمات در فایل `data/financial/grid_config.json` ذخیره می‌شود
3. دفعات بعدی که گزارش را باز می‌کنید، تنظیمات شما اعمال خواهد شد

---

## 🔄 بازگردانی به پیش‌فرض:

اگر می‌خواهید تمام تنظیمات را حذف کنید:
1. در پنجره شخصی‌سازی، روی **"🔄 بازگردانی به پیش‌فرض"** کلیک کنید
2. تأیید کنید

---

## 📥 خروجی Excel:

1. در پنجره گزارش اصلی، روی **"📥 خروجی Excel"** کلیک کنید
2. محل ذخیره فایل را انتخاب کنید
3. فایل با تمام ستون‌ها و فرمول‌های سفارشی ذخیره می‌شود

---

## 🔍 فیلترها:

در کنار دکمه بروزرسانی، می‌توانید فیلتر اعمال کنید:
- **همه**: نمایش تمام رکوردها
- **فقط سودده**: فقط آکانت‌های با سود مثبت
- **فقط زیان‌ده**: فقط آکانت‌های با سود منفی
- **موجودی دارد**: آکانت‌هایی که موجودی Gold یا Silver دارند

---

## 🖱️ Double-Click برای جزئیات:

روی هر سطر دوبار کلیک کنید تا جزئیات کامل آن Label نمایش داده شود:
- اطلاعات خرید
- اطلاعات فروش
- محاسبات سود/زیان
- آمار فروش
- موجودی

---

## 🎯 نکات مهم:

1. **ترتیب پردازش**: ابتدا باید داده‌ها Import و Process شوند
   - تب "مدیریت BI" → "Smart Import Wizard"
   - پردازش خودکار بعد از Import

2. **Platform ها**: به صورت خودکار از داده‌های Sales استخراج می‌شوند

3. **فرمول‌ها**: قبل از ذخیره، اعتبارسنجی می‌شوند

4. **تنظیمات**: بعد از تغییر، باید "ذخیره تنظیمات" را بزنید

---

## 🚀 جریان کامل کار:

```
1. Import داده‌ها
   ↓
2. پردازش خودکار (RawData → Account/Sale)
   ↓
3. باز کردن گزارش حرفه‌ای
   ↓
4. شخصی‌سازی ستون‌ها و فرمول‌ها
   ↓
5. مشاهده گزارش
   ↓
6. خروجی Excel (اختیاری)
```

---

## 📞 پشتیبانی:

در صورت بروز مشکل:
1. لاگ‌های برنامه را بررسی کنید
2. فایل `BUG_FIXES_REPORT.md` را مطالعه کنید
3. از دکمه "🔄 بازگردانی به پیش‌فرض" استفاده کنید

---

تاریخ: 2025-12-18
نسخه: 1.0.0
