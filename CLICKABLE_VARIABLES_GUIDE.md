# قابلیت جدید: متغیرهای کلیک‌پذیر در ویرایشگر فرمول
=======================================================

## ✨ قابلیت اضافه شده:

### 🖱️ متغیرهای کلیک‌پذیر

**قبل**: کاربر باید متغیرها را دستی تایپ کند:
```
{total_profit} / {gold_purchased}
```

**الان**: کاربر روی دکمه‌های متغیر کلیک می‌کند:
- دکمه `{gold_purchased}` → خودکار درج می‌شود
- دکمه `{total_profit}` → خودکار درج می‌شود
- دکمه `/` → خودکار با فاصله درج می‌شود

---

## 🎯 نحوه استفاده:

### 1. باز کردن ویرایشگر فرمول:
```
گزارش حرفه‌ای → شخصی‌سازی ستون‌ها → ➕ افزودن فرمول
```

### 2. متغیرهای کلیک‌پذیر:

**📋 بخش "متغیرهای قابل استفاده":**

```
┌─────────────────────────────────────────────┐
│ 💡 روی هر متغیر کلیک کنید تا اضافه شود   │
├─────────────────────────────────────────────┤
│  {label}           {gold_purchased}         │
│  {purchase_rate}   {purchase_cost}          │
│  {total_sold}      {total_revenue}          │
│  {total_profit}    {profit_pct}             │
│  {remaining_gold}  {remaining_silver}       │
└─────────────────────────────────────────────┘
```

**هر دکمه:**
- 🖱️ قابل کلیک
- 💡 Tooltip با توضیحات
- 🎨 رنگ آبی روشن
- ✨ افکت Hover

---

### 3. عملگرهای کلیک‌پذیر:

**🧮 بخش عملگرها:**
```
┌───────────────────────────────┐
│  [+]  [-]  [*]  [/]  [(]  [)] │
└───────────────────────────────┘
```

**هر دکمه:**
- کلیک → درج با فاصله خودکار
- مثال: کلیک `+` → ` + ` اضافه می‌شود
- پرانتز بدون فاصله: `(` یا `)`

---

### 4. دکمه‌های کمکی:

**🗑️ پاک کردن:**
- پاک کردن کل فرمول
- رنگ قرمز روشن

**💡 مثال:**
- منوی dropdown با 6 فرمول آماده:
  1. سود به ازای هر Gold
  2. مارجین سود (درصد)
  3. قیمت فروش متوسط
  4. سود خالص (با کسر کمیسیون)
  5. نسبت فروش به خرید
  6. درآمد بعد از کسر هزینه

---

## 📝 مثال عملی:

### نوشتن فرمول "سود به ازای هر Gold":

**مراحل:**
1. کلیک روی `{total_profit}`
   → فرمول: `{total_profit}`

2. کلیک روی `/`
   → فرمول: `{total_profit} / `

3. کلیک روی `{gold_purchased}`
   → فرمول: `{total_profit} / {gold_purchased}`

✅ **تمام!** بدون نیاز به تایپ

---

### نوشتن فرمول "مارجین سود":

**مراحل:**
1. کلیک `(`
2. کلیک `{total_revenue}`
3. کلیک `-`
4. کلیک `{purchase_cost}`
5. کلیک `)`
6. کلیک `/`
7. کلیک `{total_revenue}`
8. کلیک `*`
9. تایپ `100`

✅ **نتیجه:**
```
({total_revenue} - {purchase_cost}) / {total_revenue} * 100
```

---

### استفاده از مثال آماده:

**مراحل:**
1. کلیک دکمه "💡 مثال"
2. انتخاب "قیمت فروش متوسط" از منو
3. فرمول خودکار پر می‌شود:
   ```
   {total_revenue} / {total_sold}
   ```

---

## 🎨 طراحی UI:

### متغیرها:
```css
رنگ پس‌زمینه: آبی روشن (#E3F2FD)
حاشیه: آبی (#2196F3)
Hover: آبی کمرنگ‌تر (#BBDEFB)
فونت: Courier New (monospace)
```

### عملگرها:
```css
رنگ پس‌زمینه: نارنجی روشن (#FFF3E0)
حاشیه: نارنجی (#FF9800)
Hover: نارنجی کمرنگ‌تر (#FFE0B2)
سایز: 40px
```

### دکمه‌های کمکی:
```css
پاک کردن: قرمز روشن (#FFEBEE)
مثال: سبز روشن (#E8F5E9)
```

---

## 💡 مزایا:

1. **راحتی استفاده**: بدون نیاز به تایپ
2. **بدون خطا**: نام متغیرها دقیق
3. **سرعت بالا**: چند کلیک به جای تایپ
4. **UX بهتر**: visual و بصری
5. **یادگیری آسان**: کاربر متغیرها را می‌بیند

---

## 🔧 پیاده‌سازی تکنیکی:

### متدهای اضافه شده:

```python
def insert_variable(self, variable: str):
    """درج متغیر در محل cursor"""
    cursor = self.formula_input.textCursor()
    cursor.insertText(f"{{{variable}}}")
    self.formula_input.setFocus()

def insert_operator(self, operator: str):
    """درج عملگر با فاصله"""
    cursor = self.formula_input.textCursor()
    if operator in ['(', ')']:
        cursor.insertText(operator)
    else:
        cursor.insertText(f" {operator} ")
    self.formula_input.setFocus()

def insert_example(self):
    """منوی مثال‌های آماده"""
    menu = QMenu(self)
    # ... 6 مثال
    menu.exec(...)
```

---

## 📍 محل فایل‌ها:

```
app/gui/financial/
└── column_customization_dialog.py     # شامل FormulaEditorDialog
```

---

## ✅ وضعیت:

- ✅ متغیرهای کلیک‌پذیر (10 متغیر)
- ✅ عملگرهای کلیک‌پذیر (6 عملگر)
- ✅ دکمه پاک کردن
- ✅ دکمه مثال (6 فرمول آماده)
- ✅ Tooltip برای هر متغیر
- ✅ افکت Hover
- ✅ Cursor به Pointing Hand
- ✅ Focus خودکار بعد از درج

---

## 🚀 مثال واقعی:

**ایجاد ستون "ROI (بازگشت سرمایه)":**

```
1. نام: ROI
2. فرمول: (کلیک‌ها)
   {total_profit} / {purchase_cost} * 100
3. فرمت: درصد
4. ذخیره
```

**نتیجه در گزارش:**
```
Label  | ... | ROI
K449   | ... | 15.5%
K450   | ... | -8.2%
```

---

تاریخ: 2025-12-18  
نسخه: 1.1.0  
وضعیت: ✅ آماده استفاده
