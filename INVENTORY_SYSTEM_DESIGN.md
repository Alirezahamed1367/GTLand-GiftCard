# 🏭 سیستم انبار تولیدی - طراحی کامل

## 📋 شرح کلی سیستم

این نرم‌افزار مانند یک **سیستم انبار تولیدی** عمل می‌کند:

### 🔄 جریان کار:
```
مواد اولیه (آکانت‌های خریداری شده)
        ↓
    پردازش (تبدیل به محصولات)
        ↓
    محصولات (پلتفرم‌های مختلف)
        ↓
    فروش به مشتریان
```

---

## 📊 مفاهیم کلیدی

### 1️⃣ **مواد اولیه = آکانت‌های خریداری شده**
- هر آکانت یک ماده اولیه است
- دارای: Label, Email, Supplier, تاریخ خرید
- دارای: مقدار Gold, مقدار Silver
- دارای: قیمت خرید هر واحد
- دارای: قیمت کل خرید

### 2️⃣ **محصولات = پلتفرم‌های فروش**
- Roblox
- Apple Gift Card
- Google Play
- Nintendo
- Xbox
- PlayStation
- PUBG Mobile
- Free Fire
- Steam
- سایر...

### 3️⃣ **فروش**
- از هر آکانت (ماده اولیه)
- به صورت پلتفرم مشخص (محصول)
- به مشتری مشخص
- با قیمت فروش
- محاسبه سود/زیان خودکار

---

## 🗂️ ساختار جداول Database

### جدول 1: `accounts` (مواد اولیه)
```sql
- id (شناسه یکتا)
- label (برچسب آکانت - مرجع اصلی) ⭐
- email
- supplier (تامین‌کننده)
- created_at (تاریخ خرید)
- is_active (فعال/غیرفعال)
```

### جدول 2: `account_gold` (خریدهای Gold)
```sql
- id
- account_id → accounts.id
- quantity (مقدار Gold)
- price_per_unit (قیمت هر واحد)
- total_cost (قیمت کل = quantity × price_per_unit)
- purchase_date
- supplier
```

### جدول 3: `account_silver` (خریدهای Silver)
```sql
- id
- account_id → accounts.id
- quantity (مقدار Silver)
- price_per_unit (قیمت هر واحد)
- total_cost (قیمت کل)
- purchase_date
- supplier
```

### جدول 4: `sales` (فروش‌ها)
```sql
- id
- label → accounts.label (کدام آکانت؟)
- sale_type ('gold' یا 'silver')
- quantity (چه مقدار فروش رفت؟)
- platform (کدام محصول؟ مثل Roblox)
- sale_rate (ریت فروش - نرخ تبدیل)
- sale_amount (مبلغ فروش)
- profit (سود = sale_amount - cost)
- customer_code → customers.code (به چه کسی؟)
- sale_date
```

### جدول 5: `customers` (مشتریان)
```sql
- id
- code (کد مشتری - یکتا) ⭐
- name
- phone
- email
- total_purchases (تعداد کل خریدها)
- total_spent (مجموع خرج کرده)
- total_gold_bought
- total_silver_bought
- first_purchase_at
- last_purchase_at
```

### جدول 6: `platforms` (پلتفرم‌های فروش)
```sql
- id
- code (مثل 'roblox', 'apple')
- name (نام نمایشی)
- is_active
```

---

## 📊 نمای اصلی - جدول مدیریت کامل

### ستون‌های جدول:

```
┌─────────┬──────────┬──────────┬───────────────────────────────────────────────────┐
│ Label   │ Supplier │ Purchase │ Gold           │ Silver         │ Roblox  │ Apple │ ...  │
│         │          │ Date     │ (Qty/Cost)     │ (Qty/Cost)     │         │       │      │
├─────────┼──────────┼──────────┼───────────────────────────────────────────────────┤
│ A1055   │ Sup-A    │ 2025-11  │ 2000/$100 [📊] │ 500/$20 [📊]   │ [5 🔵] │ [2 🔵]│ ...  │
│ X1002   │ Unknown  │ 2025-12  │ 3000/$150 [📊] │ 0              │ [8 🔵] │ [0]   │ ...  │
│ G3200   │ Sup-C    │ 2025-11  │ 1500/$80 [📊]  │ 300/$15 [📊]   │ [0]    │ [1 🔵]│ ...  │
└─────────┴──────────┴──────────┴───────────────────────────────────────────────────┘

[📊] = کلیک → نمایش جزئیات خریدها
[🔵] = کلیک → نمایش جزئیات فروش‌ها
```

### جزئیات کلیک روی خرید (📊):
```
┌─────────────────────────────────────────┐
│ جزئیات خریدهای Gold - A1055          │
├─────────────────────────────────────────┤
│ خرید 1: 1000 @ $0.05 = $50 (Sup-A)    │
│ خرید 2: 1000 @ $0.05 = $50 (Sup-A)    │
├─────────────────────────────────────────┤
│ مجموع: 2000 Gold / $100                │
│ باقیمانده: 1200 Gold (فروخته: 800)    │
│ ارزش باقیمانده: $60                    │
└─────────────────────────────────────────┘
```

### جزئیات کلیک روی فروش (🔵):
```
┌────────────────────────────────────────────────┐
│ جزئیات فروش‌های Roblox - A1055             │
├────────────────────────────────────────────────┤
│ فروش 1:                                       │
│   • مقدار: 500 Gold                           │
│   • ریت: 1:10,000 (هر Gold = 10k Robux)      │
│   • قیمت فروش: $45                            │
│   • قیمت تمام شده: $25 (500 × $0.05)         │
│   • سود: $20                                   │
│   • مشتری: C001 - علی رضایی                   │
│   • تاریخ: 2025-12-01                          │
├────────────────────────────────────────────────┤
│ فروش 2:                                       │
│   • مقدار: 300 Gold                           │
│   • ریت: 1:10,000                             │
│   • قیمت فروش: $28                            │
│   • قیمت تمام شده: $15                        │
│   • سود: $13                                   │
│   • مشتری: C002 - محمد احمدی                  │
│   • تاریخ: 2025-12-05                          │
├────────────────────────────────────────────────┤
│ مجموع:                                         │
│   • 5 فروش                                    │
│   • 800 Gold فروخته شده                       │
│   • درآمد کل: $105                             │
│   • سود کل: $58                                │
└────────────────────────────────────────────────┘
```

---

## 📈 گزارشات مورد نیاز

### 1. گزارش موجودی هر آکانت:
```
Label: A1055
├─ Gold
│  ├─ خریداری شده: 2000
│  ├─ فروخته شده: 800
│  └─ باقیمانده: 1200
│
└─ Silver
   ├─ خریداری شده: 500
   ├─ فروخته شده: 150
   └─ باقیمانده: 350
```

### 2. گزارش سود/زیان هر پلتفرم:
```
Roblox:
  • تعداد فروش: 150
  • مجموع درآمد: $5,420
  • مجموع هزینه: $3,100
  • سود خالص: $2,320
  • Profit Margin: 42.8%

Apple Gift Card:
  • تعداد فروش: 80
  • مجموع درآمد: $3,200
  • مجموع هزینه: $2,000
  • سود خالص: $1,200
  • Profit Margin: 37.5%
```

### 3. گزارش سود/زیان کل:
```
خلاصه کل سیستم:
  • کل سرمایه‌گذاری: $10,000
  • کل فروش: $12,500
  • سود خالص: $2,500
  • Profit Margin: 20%
  • تعداد آکانت‌ها: 50
  • تعداد فروش: 320
```

### 4. مانده حساب مشتری:
```
مشتری: C001 - علی رضایی

تاریخ      | محصول  | مقدار    | مبلغ    | پرداخت  | مانده
--------------------------------------------------------------
2025-12-01 | Roblox | 500 Gold | $45     | $45     | $0
2025-12-05 | Apple  | 300 Gold | $35     | $20     | $15 (بدهکار)
2025-12-10 | Roblox | 400 Gold | $40     | $0      | $55 (بدهکار)
--------------------------------------------------------------
مجموع خریدها: $120
مجموع پرداخت‌ها: $65
مانده بدهکار: $55
```

---

## 🔧 ویژگی‌های سیستم

### ✅ فعلی (موجود):
1. ✅ Import از Google Sheets
2. ✅ Field Mapping پویا
3. ✅ شناسایی خودکار آکانت‌های جدید
4. ✅ Update خودکار آکانت‌های موجود
5. ✅ محاسبه خودکار سود
6. ✅ گزارشات پایه

### 🚧 نیاز به توسعه:
1. 🚧 جدول مدیریت کامل (DataGrid)
2. 🚧 کلیک روی سلول → نمایش جزئیات
3. 🚧 ویرایش inline داده‌ها
4. 🚧 سیستم مانده حساب مشتری
5. 🚧 گزارش ارزش باقیمانده موجودی
6. 🚧 Dashboard تعاملی

---

## 🎯 سوالات و چالش‌ها

### ❓ سوالات:

1. **ریت فروش چگونه تعیین می‌شود؟**
   - آیا هر پلتفرم ریت ثابتی دارد؟
   - یا در هر فروش ریت جداگانه‌ای ثبت می‌شود؟

2. **نرخ تمام شده چگونه محاسبه می‌شود؟**
   - FIFO (First In, First Out) - اولین خرید اول فروش
   - LIFO (Last In, First Out) - آخرین خرید اول فروش
   - Average Cost - میانگین قیمت خریدها

3. **مانده حساب مشتری:**
   - آیا نیاز به سیستم پرداخت هست؟
   - مشتری می‌تواند نسیه خرید کند؟
   - چه گزارشی برای بدهی/طلب نیاز است؟

4. **یک آکانت می‌تواند چند بار خرید داشته باشد؟**
   - بله ✅ (الان پشتیبانی می‌شود)
   - هر خرید جداگانه ثبت می‌شود

5. **ویرایش داده‌ها:**
   - کدام فیلدها قابل ویرایش هستند؟
   - آیا نیاز به Log تغییرات است؟

6. **Export/Import:**
   - فرمت Excel فعلی مناسب است؟
   - نیاز به فرمت‌های دیگری هست؟

---

## 🛠️ پیشنهادات فنی

### 1. جدول مدیریت کامل:
```python
# استفاده از QTableWidget با custom delegates
# برای هر ستون پلتفرم:
class SalesCountDelegate(QStyledItemDelegate):
    def paint(self, painter, option, index):
        # نمایش badge با تعداد فروش
        # مثل: [5 🔵]
        pass
    
    def editorEvent(self, event, model, option, index):
        # کلیک → نمایش دیالوگ جزئیات
        pass
```

### 2. Cache برای عملکرد بهتر:
```python
# Cache محاسبات سنگین
@lru_cache(maxsize=128)
def get_account_summary(label: str):
    # محاسبه موجودی، فروش، سود
    pass
```

### 3. Background Worker:
```python
# برای محاسبات سنگین
from PyQt6.QtCore import QThread

class CalculationWorker(QThread):
    def run(self):
        # محاسبات سنگین در background
        pass
```

---

## 📝 مراحل پیاده‌سازی (توصیه)

### Phase 2 - جدول مدیریت کامل:
1. ✅ طراحی UI جدول
2. ✅ Populate داده‌ها
3. ✅ Custom Delegates برای سلول‌ها
4. ✅ Dialog جزئیات خرید
5. ✅ Dialog جزئیات فروش
6. ✅ ویرایش inline

### Phase 3 - سیستم مشتری:
1. ✅ جدول مشتریان کامل
2. ✅ ثبت پرداخت
3. ✅ محاسبه مانده حساب
4. ✅ گزارش بدهی/طلب

### Phase 4 - Dashboard تعاملی:
1. ✅ Charts و نمودارها
2. ✅ Filters پیشرفته
3. ✅ Export سفارشی

---

## 🎨 Mock-up UI (پیشنهادی)

```
╔════════════════════════════════════════════════════════════╗
║  GT-Land Manager - مدیریت انبار تولیدی گیفت کارت        ║
╠════════════════════════════════════════════════════════════╣
║                                                            ║
║  [📊 Dashboard] [📦 موجودی] [💰 فروش] [👥 مشتریان]      ║
║                                                            ║
║  ┌────────────────────────────────────────────────────┐   ║
║  │ Label │ Supplier │ Gold      │ Silver    │ Roblox │   ║
║  ├────────────────────────────────────────────────────┤   ║
║  │ A1055 │ Sup-A    │ 2000/$100 │ 500/$20   │ [5 🔵] │   ║
║  │       │          │    [📊]   │   [📊]    │        │   ║
║  ├────────────────────────────────────────────────────┤   ║
║  │ X1002 │ Unknown  │ 3000/$150 │ 0         │ [8 🔵] │   ║
║  │       │          │    [📊]   │           │        │   ║
║  └────────────────────────────────────────────────────┘   ║
║                                                            ║
║  [➕ افزودن خرید] [📥 Import] [📤 Export] [🔍 جستجو]     ║
║                                                            ║
╚════════════════════════════════════════════════════════════╝
```

---

## ✅ تصمیمات فوری مورد نیاز:

1. **ریت فروش:** ثابت یا متغیر؟
2. **نرخ تمام شده:** FIFO, LIFO یا Average؟
3. **مانده حساب:** نیاز به سیستم پرداخت هست؟
4. **اولویت توسعه:** کدام Phase اول؟

---

این یک سیستم کامل است. منتظر پاسخ سوالات شما هستم تا بتوانیم پیاده‌سازی را شروع کنیم! 🚀
